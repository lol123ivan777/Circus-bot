/**
 * src/handlers/about.js
 */

exports.handleAbout = async (bot, input) => {
  const isCallback = !!input?.data;       // –µ—Å–ª–∏ callbackQuery ‚Äî –∑–¥–µ—Å—å —Å—Ç—Ä–æ–∫–∞
  const msg = isCallback ? input.message : input.message; // –æ–¥–∏–Ω–∞–∫–æ–≤–æ, –Ω–æ –¥–∞–ª—å—à–µ —Ä–∞–∑–¥–µ–ª–∏–º

  const chatId =
    msg?.chat?.id ||
    input?.chat?.id ||
    input?.from?.id;

  if (!chatId) {
    console.error('ABOUT ERROR: chatId –Ω–µ –Ω–∞–π–¥–µ–Ω');
    return;
  }

  const text =
    'üé™ *–¶–∏—Ä–∫ –ù–∏–∫—É–ª–∏–Ω–∞ ‚Äî –∏—Å—Ç–æ—Ä–∏—è –∏ —Ç—Ä–∞–¥–∏—Ü–∏–∏* üé™\n\n' +
    '*üìç –ê–¥—Ä–µ—Å:* –ú–æ—Å–∫–≤–∞, –¶–≤–µ—Ç–Ω–æ–π –±—É–ª—å–≤–∞—Ä, –¥–æ–º 13\n' +
    '*üìû –¢–µ–ª–µ—Ñ–æ–Ω:* +7 (495) 628-8349\n\n' +
    '*üèõ –û–¥–∏–Ω –∏–∑ —Å—Ç–∞—Ä–µ–π—à–∏—Ö —Ü–∏—Ä–∫–æ–≤ –†–æ—Å—Å–∏–∏.* –ó–¥–∞–Ω–∏–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–æ –≤ 1880 –≥–æ–¥—É. ' +
    '–ü–µ—Ä–≤—ã–π —Å–ø–µ–∫—Ç–∞–∫–ª—å –ø—Ä–æ—à—ë–ª 20 –æ–∫—Ç—è–±—Ä—è —Ç–æ–≥–æ –∂–µ –≥–æ–¥–∞. –° —Ç–µ—Ö –ø–æ—Ä —Ü–∏—Ä–∫ –Ω–µ–æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ —Ä–µ–∫–æ–Ω—Å—Ç—Ä—É–∏—Ä–æ–≤–∞–ª—Å—è, –Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª –¥—É—Ö –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–≥–æ —Ü–∏—Ä–∫–æ–≤–æ–≥–æ –∏—Å–∫—É—Å—Å—Ç–≤–∞.\n\n' +
    '*üåü –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ –∞—Ä—Ç–∏—Å—Ç—ã.* –°—Ä–µ–¥–∏ –ø–µ—Ä–≤—ã—Ö –∑–≤—ë–∑–¥ ‚Äî –∫–ª–æ—É–Ω—ã, –¥—Ä–µ—Å—Å–∏—Ä–æ–≤—â–∏–∫–∏ –∏ –∞—Ä—Ç–∏—Å—Ç—ã —Å–æ –≤—Å–µ–≥–æ –º–∏—Ä–∞. ' +
    '–¶–∏—Ä–∫ —Å—Ç–∞–ª –¥–æ–º–æ–º –≤–µ–ª–∏–∫–æ–≥–æ –Æ—Ä–∏—è –ù–∏–∫—É–ª–∏–Ω–∞.\n\n' +
    '*üé≠ –ß—Ç–æ –º—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º:* —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞—Ä—Ç–∏—Å—Ç–∞—Ö, –Ω–æ–≤–æ—Å—Ç–∏ –∏ —É–¥–æ–±–Ω–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–ª–µ—Ç–æ–≤.\n\n' +
    '–í—ã–±–∏—Ä–∞–π—Ç–µ —Ä–∞–∑–¥–µ–ª –≤ –º–µ–Ω—é üëá';

  const keyboard = {
    inline_keyboard: [
      [{ text: '‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é', callback_data: 'back_to_menu' }]
    ]
  };

  // –ï—Å–ª–∏ callbackQuery ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º
  if (isCallback) {
    return bot.editMessageText(text, {
      chat_id: chatId,
      message_id: msg.message_id,
      parse_mode: 'Markdown',
      reply_markup: keyboard
    }).catch(err => {
      console.error('EDIT ERROR:', err);
      return bot.sendMessage(chatId, text, {
        parse_mode: 'Markdown',
        reply_markup: keyboard
      });
    });
  }

  // –ï—Å–ª–∏ –æ–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ
  return bot.sendMessage(chatId, text, {
    parse_mode: 'Markdown',
    reply_markup: keyboard
  });
};